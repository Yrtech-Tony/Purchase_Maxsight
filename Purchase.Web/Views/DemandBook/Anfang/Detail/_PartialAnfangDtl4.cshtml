@using Purchase.Web.Common
@model Purchase.DAL.Requirement_Anfang_RequirementDtl4

<form id="anfang-dtl4-form">
    @Html.Hidden("SeqNO", 0)
    <div class="form-horizontal">
        <div class="form-group">
            <label class="control-label col-md-2" for="ExecuteType">执行分类</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.ExecuteType, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-执行分类"),
                  htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="CustomerType">客户分类</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.CustomerType, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-客户分类"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="BrandType">品牌分类</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.BrandType, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-品牌分类"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="IntoShopType">进店方式</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.IntoShopType, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-进店方式"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="CarChk">开车进店</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.CarChk, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-开车进店"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="IntoShopTypeRate">进店方式比例</label>
            <div class="col-md-4">
                @{
                    List<SelectListItem> IntoShopAgainRateList = new List<SelectListItem>();
                    IntoShopAgainRateList.Add(new SelectListItem() { Text = "", Value = "" });
                    for (int i = 1; i <= 100; i++)
                    {
                        IntoShopAgainRateList.Add(new SelectListItem() { Text = i.ToString() + '%', Value = i.ToString() + '%' });
                    }
                    IntoShopAgainRateList.Add(new SelectListItem() { Text = "不涉及", Value = "不涉及" });
                    IntoShopAgainRateList.Add(new SelectListItem() { Text = "不限制", Value = "不限制" });
                }
                @Html.DropDownListFor(m => m.IntoShopTypeRate, IntoShopAgainRateList, htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="CarType">车辆类别</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.CarType, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-车辆类别"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="CarPriceRange">车价范围</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.CarPriceRange, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-车价范围"),
                    htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            @*<div class="col-md-4">
                    @Html.TextBoxFor(m => m.CarPriceRange, htmlAttributes: new { @class = "form-control", multiple="" })
                </div>*@
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="CarLevel">车型级别</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.CarLevel, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-车型级别"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="SampleCount">样本量</label>
            <div class="col-md-4">
                @Html.TextBoxFor(m => m.SampleCount, htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="DrivingLicense">进店规避要求</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.Avoid, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-进店规避要求")
                , htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="DrivingLicense">二次进店</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.IntoShopAgain, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-二次进店")
                , htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="DrivingLicense">二次进店比例</label>
            <div class="col-md-4">
                @{
                    List<SelectListItem> IntoShopAgainRateList1 = new List<SelectListItem>();
                    IntoShopAgainRateList1.Add(new SelectListItem() { Text = "", Value = "" });
                    for (int i = 1; i <= 100; i++)
                    {
                        IntoShopAgainRateList1.Add(new SelectListItem() { Text = i.ToString() + '%', Value = i.ToString() + '%' });
                    }
                    IntoShopAgainRateList1.Add(new SelectListItem() { Text = "不涉及", Value = "不涉及" });
                    IntoShopAgainRateList1.Add(new SelectListItem() { Text = "不限制", Value = "不限制" });
                }
                @Html.DropDownListFor(m => m.IntoShopAgainRate, IntoShopAgainRateList, htmlAttributes: new { @class = "form-control" })
            </div>
            <label class="control-label col-md-2" for="Compensation">报酬金额</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.Compensation, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-报酬金额"),
                   htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="ListSource">名单来源</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.ListSource, SelectListTool.HiddenCodeList("需求书-暗访-配额要求-名单来源"),
                 htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
            <label class="control-label col-md-2" for="RemarkDtl5">其他说明</label>
            <div class="col-md-4">
                @Html.TextAreaFor(m => m.RemarkDtl4, htmlAttributes: new { @class = "form-control", multiple = "" })
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input id="saveBtn" type="button" value="保存" class="btn btn-primary btn-check" data-loading-text="提交中..." style="width:100px;height:35px" />
            </div>
        </div>
    </div>
</form>
<script>
    $(function () {

        $("#anfang-dtl4-form #saveBtn").click(function () {

            if (!CommitCheck()) {
                alert("正在审核中或者非本人添加的项目");
                return false;
            }
            $("#myModal .modal-body #SeqNO").val($("#SeqNOForLocalCopy").val());
            $(this).button("loading")
            debugger;
            if ($("#myModal .modal-body #SeqNO").val() != "0") {
                var row = {
                    SeqNO: $("#myModal .modal-body #SeqNO").val(),
                    ExecuteType: $("#ExecuteType").val(), CustomerType: $("#CustomerType").val(), BrandType: $("#BrandType").val(), IntoShopType: $("#IntoShopType").val()
              , CarChk: $("#CarChk").val(), IntoShopTypeRate: $("#IntoShopTypeRate").val(), CarType: $("#CarType").val(), CarPriceRange: $("#CarPriceRange").val()
              , CarLevel: $("#CarLevel").val(), SampleCount: $("#SampleCount").val()
              , Avoid: $("#Avoid").val(), IntoShopAgain: $("#IntoShopAgain").val(), IntoShopAgainRate: $("#IntoShopAgainRate").val()
              , Compensation: $("#Compensation").val(), ListSource: $("#ListSource").val(), RemarkDtl4: $("#RemarkDtl4").val()
                };
                var insertCount = 0;
                for (var i = 0; i < sourceData.length; i++) {
                    if (sourceData[i].SeqNO == $("#myModal .modal-body #SeqNO").val()) {
                        insertCount = i;
                    }
                }
                // sourceData.splice($("#myModal .modal-body #SeqNO").val() - 1, 1, row);
                sourceData.splice(insertCount, 1, row);
            }
            else {
                var num = 1;
                if (sourceData.length != 0)
                { num = Number(sourceData[sourceData.length - 1].SeqNO) + 1; }
                var row = {
                    SeqNO: num,
                    ExecuteType: $("#ExecuteType").val(), CustomerType: $("#CustomerType").val(), BrandType: $("#BrandType").val(), IntoShopType: $("#IntoShopType").val()
              , CarChk: $("#CarChk").val(), IntoShopTypeRate: $("#IntoShopTypeRate").val(), CarType: $("#CarType").val(), CarPriceRange: $("#CarPriceRange").val()
              , CarLevel: $("#CarLevel").val(), SampleCount: $("#SampleCount").val()
              , Avoid: $("#Avoid").val(), IntoShopAgain: $("#IntoShopAgain").val(), IntoShopAgainRate: $("#IntoShopAgainRate").val()
              , Compensation: $("#Compensation").val(), ListSource: $("#ListSource").val(), RemarkDtl4: $("#RemarkDtl4").val()
                };
                sourceData.push(row);
            }
            loadpage();
            closeModal();

            //var params = $("#anfang-dtl4-form").serializeJson('&');
            //params = $.extend(params, getMstObject());

            //$.post("/DemandBook/SaveAnfangDtl4", params, function (data) {
            //    $("#RequirementId").val(data);
            //    loadAnfangDtl4();
            //    closeModal();
            //});
        })
    })
</script>